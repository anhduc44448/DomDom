<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>ƒê·∫∑t m√≥n - ƒêom ƒë√≥m qu√°n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/order.css">
  <style>
    .product-loading {
      text-align: center;
      padding: 50px 0;
    }

    .product-not-found {
      text-align: center;
      padding: 50px 0;
      color: #dc3545;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <img src="logo.png" alt="ƒêom ƒë√≥m qu√°n" width="150">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Trang ch·ªß</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">Gi·ªõi thi·ªáu</a></li>
          <li class="nav-item"><a class="nav-link" href="menu.html">Th·ª±c ƒë∆°n</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Li√™n h·ªá</a></li>
          <li class="nav-item"><a class="nav-link" href="cart.html">üõí Gi·ªè h√†ng</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <button id="loginBtn" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>

  <div class="order-container">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="order-box">
            <div id="orderContent">
              <div class="product-loading">
                <div class="spinner-border text-warning" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">ƒêang t·∫£i th√¥ng tin s·∫£n ph·∫©m...</p>
              </div>
            </div>
<<<<<<< HEAD
=======

            <form id="orderForm" class="order-form">
              <!-- Quantity & Size -->
              <div class="form-section">
                <h4>Th√¥ng tin m√≥n</h4>
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="quantity" class="form-label">S·ªë l∆∞·ª£ng</label>
                      <div class="quantity-control">
                        <button type="button" class="quantity-btn" id="decreaseQty">-</button>
                        <input type="number" class="form-control" id="quantity" value="1" min="1" max="10">
                        <button type="button" class="quantity-btn" id="increaseQty">+</button>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label class="form-label">K√≠ch c·ª°</label>
                      <div class="size-options">
                        <label class="size-option">
                          <input type="radio" name="size" value="S">
                          <span class="size-label">Nh·ªè</span>
                          <span class="size-price">+0ƒë</span>
                        </label>
                        <label class="size-option active">
                          <input type="radio" name="size" value="M" checked>
                          <span class="size-label">V·ª´a</span>
                          <span class="size-price">+0ƒë</span>
                        </label>
                        <label class="size-option">
                          <input type="radio" name="size" value="L">
                          <span class="size-label">L·ªõn</span>
                          <span class="size-price">...</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>



              <!-- Order Summary -->
              <div class="form-section">
                <h4>T√≥m t·∫Øt ƒë∆°n h√†ng</h4>
                <div class="order-summary">
                  <div class="summary-item">
                    <span>ƒê∆°n gi√°:</span>
                    <span id="basePrice">0ƒë</span>
                  </div>
                  <div class="summary-item">
                    <span>Ph√≠ size:</span>
                    <span id="sizePrice">0ƒë</span>
                  </div>
                  <div class="summary-item">
                    <span>S·ªë l∆∞·ª£ng:</span>
                    <span id="summaryQuantity">1</span>
                  </div>
                  <div class="summary-divider"></div>
                  <div class="summary-total">
                    <span>T·ªïng c·ªông:</span>
                    <span id="totalPrice" class="total-price">0ƒë</span>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="form-actions">
                <button type="submit" class="btn btn-order btn-lg">Th√™m v√†o gi·ªè h√†ng</button>
                <a href="menu.html" class="btn btn-secondary btn-lg">‚Üê Quay v·ªÅ th·ª±c ƒë∆°n</a>
              </div>
            </form>
>>>>>>> db8b244a84e9f5a8fddafc43aaa9f8a888cdf0f7
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2024 ƒêom ƒë√≥m qu√°n</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    async function loadProduct() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('id');

      if (!productId) {
        showProductNotFound();
        return;
      }

      try {
        const response = await fetch(`api/get_product_by_id.php?id=${productId}`);
        const result = await response.json();

        if (result.success) {
          displayProduct(result.data);
        } else {
          showProductNotFound();
        }
      } catch (error) {
        console.error('L·ªói t·∫£i s·∫£n ph·∫©m:', error);
        showProductNotFound();
      }
    }

    function displayProduct(product) {
      const price = formatPrice(product.price);
      const imageUrl = product.image_path || 'database/AnhDoAn/BanhTranBo.jpg';

      const html = `
                <div class="order-header">
                    <h2>ƒê·∫∑t m√≥n: <span class="item-name">${product.name}</span></h2>
                    <div class="item-image">
                        <img src="${imageUrl}" alt="${product.name}" 
                             onerror="this.src='database/AnhDoAn/BanhTranBo.jpg'">
                    </div>
                </div>

                <form id="orderForm" class="order-form">
                    <!-- Quantity & Size -->
                    <div class="form-section">
                        <h4>Th√¥ng tin m√≥n</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="quantity" class="form-label">S·ªë l∆∞·ª£ng</label>
                                    <div class="quantity-control">
                                        <button type="button" class="quantity-btn" id="decreaseQty">-</button>
                                        <input type="number" class="form-control" id="quantity" value="1" min="1" max="10">
                                        <button type="button" class="quantity-btn" id="increaseQty">+</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">K√≠ch c·ª°</label>
                                    <div class="size-options">
                                        <label class="size-option">
                                            <input type="radio" name="size" value="S">
                                            <span class="size-label">Nh·ªè</span>
                                            <span class="size-price">+0ƒë</span>
                                        </label>
                                        <label class="size-option active">
                                            <input type="radio" name="size" value="M" checked>
                                            <span class="size-label">V·ª´a</span>
                                            <span class="size-price">+0ƒë</span>
                                        </label>
                                        <label class="size-option">
                                            <input type="radio" name="size" value="L">
                                            <span class="size-label">L·ªõn</span>
                                            <span class="size-price">+5.000ƒë</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Summary -->
                    <div class="form-section">
                        <h4>T√≥m t·∫Øt ƒë∆°n h√†ng</h4>
                        <div class="order-summary">
                            <div class="summary-item">
                                <span>ƒê∆°n gi√°:</span>
                                <span id="basePrice">${price}ƒë</span>
                            </div>
                            <div class="summary-item">
                                <span>Ph√≠ size:</span>
                                <span id="sizePrice">0ƒë</span>
                            </div>
                            <div class="summary-item">
                                <span>S·ªë l∆∞·ª£ng:</span>
                                <span id="summaryQuantity">1</span>
                            </div>
                            <div class="summary-divider"></div>
                            <div class="summary-total">
                                <span>T·ªïng c·ªông:</span>
                                <span id="totalPrice" class="total-price">${price}ƒë</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-order btn-lg">Th√™m v√†o gi·ªè h√†ng</button>
                        <a href="menu.html" class="btn btn-secondary btn-lg">‚Üê Quay v·ªÅ th·ª±c ƒë∆°n</a>
                    </div>
                </form>
            `;

      document.getElementById('orderContent').innerHTML = html;
      initOrderControls(product);
    }

    function showProductNotFound() {
      document.getElementById('orderContent').innerHTML = `
                <div class="product-not-found">
                    <h3>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h3>
                    <p>S·∫£n ph·∫©m b·∫°n t√¨m ki·∫øm kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ b·ªã x√≥a.</p>
                    <a href="menu.html" class="btn btn-primary">Quay v·ªÅ th·ª±c ƒë∆°n</a>
                </div>
            `;
    }

    function initOrderControls(product) {
      const basePrice = product.price;
      let currentQuantity = 1;
      let currentSize = 'M';

      // Quantity controls
      const quantityInput = document.getElementById('quantity');
      const decreaseBtn = document.getElementById('decreaseQty');
      const increaseBtn = document.getElementById('increaseQty');

      decreaseBtn.addEventListener('click', () => {
        if (currentQuantity > 1) {
          currentQuantity--;
          quantityInput.value = currentQuantity;
          updateTotalPrice();
        }
      });

      increaseBtn.addEventListener('click', () => {
        if (currentQuantity < 10) {
          currentQuantity++;
          quantityInput.value = currentQuantity;
          updateTotalPrice();
        }
      });

      quantityInput.addEventListener('change', function () {
        let value = parseInt(this.value);
        if (value < 1) this.value = 1;
        if (value > 10) this.value = 10;
        currentQuantity = parseInt(this.value);
        updateTotalPrice();
      });

      // Size selection
      const sizeOptions = document.querySelectorAll('.size-option');
      sizeOptions.forEach(option => {
        option.addEventListener('click', function () {
          sizeOptions.forEach(opt => opt.classList.remove('active'));
          this.classList.add('active');
          this.querySelector('input[type="radio"]').checked = true;
          currentSize = this.querySelector('input[type="radio"]').value;
          updateTotalPrice();
        });
      });

      // Form submission
      const orderForm = document.getElementById('orderForm');
      orderForm.addEventListener('submit', function (e) {
        e.preventDefault();
        addToCart(product);
      });

      function updateTotalPrice() {
        const sizeMultiplier = currentSize === 'L' ? 1.2 : 1;
        const sizeExtra = currentSize === 'L' ? basePrice * 0.2 : 0;
        const total = (basePrice * sizeMultiplier) * currentQuantity;

        document.getElementById('basePrice').textContent = formatPrice(basePrice) + 'ƒë';
        document.getElementById('sizePrice').textContent = formatPrice(sizeExtra * currentQuantity) + 'ƒë';
        document.getElementById('summaryQuantity').textContent = currentQuantity;
        document.getElementById('totalPrice').textContent = formatPrice(total) + 'ƒë';
      }

      updateTotalPrice();
    }

    function addToCart(product) {
      const quantity = parseInt(document.getElementById('quantity').value);
      const size = document.querySelector('input[name="size"]:checked').value;
      const basePrice = product.price;
      const sizeMultiplier = size === 'L' ? 1.2 : 1;
      const total = (basePrice * sizeMultiplier) * quantity;

      const cartItem = {
        product_id: product.id,
        name: product.name,
        img: product.image_path || 'database/AnhDoAn/BanhTranBo.jpg',
        quantity: quantity,
        size: size,
        price: basePrice,
        total: total,
        addedAt: new Date().toISOString()
      };

      // L·∫•y gi·ªè h√†ng hi·ªán t·∫°i
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      cart.push(cartItem);
      localStorage.setItem('cart', JSON.stringify(cart));

      // Hi·ªÉn th·ªã th√¥ng b√°o
      alert(`‚úÖ ƒê√£ th√™m ${product.name} v√†o gi·ªè h√†ng!`);

      // Chuy·ªÉn v·ªÅ trang menu sau 1 gi√¢y
      setTimeout(() => {
        window.location.href = 'menu.html';
      }, 1000);
    }

    function formatPrice(price) {
      return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    // Load product khi trang load
    document.addEventListener('DOMContentLoaded', function () {
      loadProduct();
    });
  </script>
</body>

</html>